################# 設定 #################
use strict;
use utf8;

package set;

use lib './module';
require './lib/pl/config-default.pl';

## ●ホームURL（ゆとチャadv.TOPから更に戻るリンク）
our $home_url = '';

## ●ログ削除パスワード （空欄のままだと「誰でも」可能です。注意してください）
our $password = '';

## ●過去ログ保存ディレクトリ
our $logs_dir = './logs/';

## ●BCDice-APIのURL（SWとDX以外を遊ぶ場合は必須です）
our $bcdice_api = '';

## ●部屋設定
our %rooms = (
  'SW' => {
    'name' => 'ゲームルームSW',
    'game' => 'sw2',
  },
  'DX' => {
    'name' => 'ゲームルームDX',
    'game' => 'dx3',
  },
  'Ch' => {
    'name' => 'ゲームルームCthulhu',
    'game' => 'Cthulhu',
    'status' => ['HP','MP','SAN'],
    'bcdice' => 1,
  },
  
#  '部屋ID' => {
#    'name' => '',                 #部屋の名前
#    'game' => '',                 #ゲームID（省略で「その他」扱い）
#    'tab' => ['メイン','サブ'],   #タブの一覧。省略するとデフォルト（メイン+サブ）を設定
#    'secret' => 0,                #一覧から隠すかどうか（1で隠す、0ないし省略で表示）
#    'status' => ['HP','MP','他'], #ユニットに表示するステータス（省略するとデフォルト設定を使用）
#    'bcdice' => 0,                #BCDiceの使用の有無（1で使用、0ないし省略で不使用）
#    'logs-dir' => './logs/',      #過去ログの保存先 その部屋だけ別にしたい時に指定
#  },
);

our $userroom_on = 0; # ユーザーがゲームルームの作成を許可するかどうか（1=許可 0=不許可）
our $userroom_max = 0; # ユーザー追加できるゲームルームの数の上限（0=無制限）

our $logname_id_add = 1; # 過去ログのファイル名の末尾にIDを入れるかどうか（1=入れる 0=入れない）

## 部屋ID　URL（id=xxの部分）に使用（半角英数字、-、_などURLに使用できる文字推奨）
#
## ゲームID
#（内蔵ダイスの判別に関わる）
# ソードワールド2.x: sw2
# ダブルクロス3rd  : dx3
#
# BCDice使用の場合、BCDiceのシステムIDを記入することで使用することで使用するダイスbotのシステムを固定できます。
# （クトゥルフ神話RPGなら 'Cthulhu' など）
# 空欄にすると、ユーザー側が任意に選択できます。

## ●ランダムテーブル：「n＠＊＊＊」でtxtファイルの内容からランダムにチョイスできるようにする
our %random_table = (
  'じゃんけん' => { 'data'=>'janken.txt', 'max'=>1, 'def'=>1, 'help'=>'グー、チョキ、パーをランダムに表示します' },
  
  # '経歴' => { 'data'=>'history.txt', 'max'=>3, 'def'=>3, 'help' => "ヘルプに表示する説明" },
  # これならたとえば「3＠経歴」で history.txtの内容から3つ表示、
  # 一度に振れるのは最大3つまで、個数を省略すると3つ表示……となる。
);
our $rtable_dir = './rtable/'; # txtファイルを入れるディレクトリ
# txtファイルの内容は1行1項目

## ●テキスト置換定義
our %replace_rule = (
  # SW2の魔法の武器、刃武器、打撃武器アイコン（いらない場合は消してよい）
  '[魔]' => '<img alt="[魔]" class="icon" src="./lib/img/icon/sw-wp-magic.png">',
  '[刃]' => '<img alt="[刃]" class="icon" src="./lib/img/icon/sw-wp-edge.png">',
  '[打]' => '<img alt="[打]" class="icon" src="./lib/img/icon/sw-wp-blow.png">',
  
  # '置換前の文字列' => '置換後の文字列',
);

## ●テキスト置換定義（正規表現）
# 基本で使える以外のタグを使用可能にしたい場合など。
# メタ文字のエスケープ等が必要。注意。
our @replace_regex = (
    #シーンタイトル
    { '(</h\d>|^|\n|<hr>)#{3}\s((?:(?!#{3})(?!▼)(?:.|\n))*?)(?:\n)?\[\[((?:.|\n)+?)\]\](\n)*' => '$1<div class="sceneTitle">$2<div class="caption">$3</div></div>' },
    { '^#{3}!\s(.+?)\n((?:.|\n)+?)$' => '<div class="sceneTitle">$1<div class="caption">$2</div></div>' },

    # markdown
    #見出し
    { '(</div>|</h\d>|^|\n|<hr>)#{1}\s(.+?)(\n|$)' => '$1<h1 class="orgHeader">$2</h1>' },
    { '(</div>|</h\d>|^|\n|<hr>)#{2}\s(.+?)(\n|$)' => '$1<h2 class="orgHeader">$2</h2>' },
    { '(</div>|</h\d>|^|\n|<hr>)#{3}\s(.+?)(\n|$)' => '$1<h3 class="orgHeader">$2</h3>' },
    { '(</div>|</h\d>|^|\n|<hr>)#{4}\s(.+?)(\n|$)' => '$1<h4 class="orgHeader">$2</h4>' },
    #水平線
    { '(</div>|</h\d>|^|\n|<hr>)---+(\n|$)' => '$1<hr>' },
    { '(</div>|</h\d>|^|\n|<hr>)- -( -)+(\n|$)' => '$1<hr>' },
    { '(</div>|</h\d>|^|\n|<hr>)___+(\n|$)' => '$1<hr>' },
    { '(</div>|</h\d>|^|\n|<hr>)\*\*\*+(\n|$)' => '$1<hr>' },
    { '(</div>|</h\d>|^|\n|<hr>)_ _( _)+(\n|$)' => '$1<hr>' },
    { '(</div>|</h\d>|^|\n|<hr>)\* \*( \*)+(\n|$)' => '$1<hr>' },

    #リスト
    #<ul>の設定。入れ子3つまで対応
    { '(</div>|</h\d>|^|\n|<hr>|<ul class="bodylist">|<ol class="bodylist">)(((\s{2}|\s{4}|\t){0}(-|\*|\+)\s.*?(</ol>|</ul>|\n|$))((\s{2}|\s{4}|\t){0,}(-|\*|\+|\d+\.)\s.*?(<ol>|</ul>|\n|$)(<ol>|</ul>|$)*)*)' => '$1<ul class="bodylist">$2</ul>' },
    { '(</div>|</h\d>|^|\n|<hr>|<ul class="bodylist">|<ol class="bodylist">)(((\s{2}|\s{4}|\t){1}(-|\*|\+)\s.*?(</ol>|</ul>|\n|$))((\s{2}|\s{4}|\t){1,}(-|\*|\+|\d+\.)\s.*?(<ol>|</ul>|\n|$)(<ol>|</ul>|$)*)*)' => '$1<ul class="bodylist">$2</ul>' },
    { '(</div>|</h\d>|^|\n|<hr>|<ul class="bodylist">|<ol class="bodylist">)(((\s{2}|\s{4}|\t){2}(-|\*|\+)\s.*?(</ol>|</ul>|\n|$))((\s{2}|\s{4}|\t){2,}(-|\*|\+|\d+\.)\s.*?(<ol>|</ul>|\n|$)(<ol>|</ul>|$)*)*)' => '$1<ul class="bodylist">$2</ul>' },
    { '(</div>|</h\d>|^|\n|<hr>|<ul class="bodylist">|<ol class="bodylist">)(((\s{2}|\s{4}|\t){3}(-|\*|\+)\s.*?(</ol>|</ul>|\n|$))((\s{2}|\s{4}|\t){3,}(-|\*|\+|\d+\.)\s.*?(<ol>|</ul>|\n|$)(<ol>|</ul>|$)*)*)' => '$1<ul class="bodylist">$2</ul>' },
    #<ol>の設定。入れ子3つまで
    { '(</div>|</h\d>|^|\n|<hr>|<ul class="bodylist">|<ol class="bodylist">)(((\s{2}|\s{4}|\t){0}\d+\.\s.*?(</ol>|</ul>|\n|$))((<ul class="bodylist">)*(\s{2}|\s{4}|\t){0,}(-|\*|\+|\d+\.)\s.*?(<ol>|</ul>|\n|$)(<ol>|</ul>|$)*)*)' => '$1<ol class="bodylist">$2</ol>' },
    { '(</div>|</h\d>|^|\n|<hr>|<ul class="bodylist">|<ol class="bodylist">)(((\s{2}|\s{4}|\t){1}\d+\.\s.*?(</ol>|</ul>|\n|$))((<ul class="bodylist">)*(\s{2}|\s{4}|\t){1,}(-|\*|\+|\d+\.)\s.*?(<ol>|</ul>|\n|$)(<ol>|</ul>|$)*)*)' => '$1<ol class="bodylist">$2</ol>' },
    { '(</div>|</h\d>|^|\n|<hr>|<ul class="bodylist">|<ol class="bodylist">)(((\s{2}|\s{4}|\t){2}\d+\.\s.*?(</ol>|</ul>|\n|$))((<ul class="bodylist">)*(\s{2}|\s{4}|\t){2,}(-|\*|\+|\d+\.)\s.*?(<ol>|</ul>|\n|$)(<ol>|</ul>|$)*)*)' => '$1<ol class="bodylist">$2</ol>' },
    { '(</div>|</h\d>|^|\n|<hr>|<ul class="bodylist">|<ol class="bodylist">)(((\s{2}|\s{4}|\t){3}\d+\.\s.*?(</ol>|</ul>|\n|$))((<ul class="bodylist">)*(\s{2}|\s{4}|\t){3,}(-|\*|\+|\d+\.)\s.*?(<ol>|</ul>|\n|$)(<ol>|</ul>|$)*)*)' => '$1<ol class="bodylist">$2</ol>' },
    #<li>の設定
    { '(</div>|</h\d>|^|\n|<hr>|<ul class="bodylist">|<ol class="bodylist">|</ul>|</ol>|</li>)((\s{2}|\s{4}|\t)*(-|\*|\+|\d+\.)\s(.*?)(\n|$))' => '$1<li>$5</li>' },
    { '(</li>)((\s{2}|\s{4}|\t)*(-|\*|\+|\d+\.)\s(.*?)(\n|$))' => '$1<li>$5</li>' },

    #コンボの見やすいあれこれ
    { '▼\[\[((?:.|\n)+?)\|(?:\n)?((?:.|\n)+?)\]\](\n)?' => '<details><summary>$1</summary><div class="detail_detail">$2</div></details>' },
    { '^▼▼(.+?)\n((?:.|\n)+?)$' => '<details><summary>$1</summary><div class="detail_detail">$2</div></details>' },

    #表
    { '[|｜]{2}(.+?)[|｜](.+?)[|｜](.+?)[|｜](.+?)[|｜](.+?)[|｜](.+?)[|｜](.+?)[|｜]{2}\n*' => '<tr><td>$1</td><td>$2</td><td>$3</td><td>$4</td><td>$5</td><td>$6</td><td>$7</td></tr>' },
    { '[|｜]{2}(.+?)[|｜](.+?)[|｜](.+?)[|｜](.+?)[|｜](.+?)[|｜](.+?)[|｜]{2}\n*' => '<tr><td>$1</td><td>$2</td><td>$3</td><td>$4</td><td>$5</td><td>$6</td></tr>' },
    { '[|｜]{2}(.+?)[|｜](.+?)[|｜](.+?)[|｜](.+?)[|｜](.+?)[|｜]{2}\n*' => '<tr><td>$1</td><td>$2</td><td>$3</td><td>$4</td><td>$5</td></tr>' },
    { '[|｜]{2}(.+?)[|｜](.+?)[|｜](.+?)[|｜](.+?)[|｜]{2}\n*' => '<tr><td>$1</td><td>$2</td><td>$3</td><td>$4</td></tr>' },
    { '[|｜]{2}(.+?)[|｜](.+?)[|｜](.+?)[|｜]{2}\n*' => '<tr><td>$1</td><td>$2</td><td>$3</td></tr>' },
    { '[|｜]{2}(.+?)[|｜](.+?)[|｜]{2}\n*' => '<tr><td>$1</td><td>$2</td></tr>' },
    { '[|｜]{2}(.+?)[|｜]{2}\n*' => '<tr><td>$1</td></tr>' },
    { '((<tr>(<td>.*?</td>)+?</tr>\n*)+)' => '<table>$1</table>' },

    #引用
    { '(</div>|</h\d>|^|\n|<hr>|</ul>|</ol>|</table>|<blockquote class="org">)(((&gt\;\s?){1,}(.+?(\n|$)))+)' => '$1<blockquote class="org">$2</blockquote>' },
    { '(</div>|</h\d>|^|\n|<hr>|</ul>|</ol>|</table>|<blockquote class="org">)(((&gt\;\s?){2,}(.+?(\n|$)))+)' => '$1<blockquote class="org">$2</blockquote>' },
    { '(</div>|</h\d>|^|\n|<hr>|</ul>|</ol>|</table>|<blockquote class="org">)(((&gt\;\s?){3,}(.+?(\n|$)))+)' => '$1<blockquote class="org">$2</blockquote>' },
    { '(</div>|</h\d>|^|\n|<hr>|</ul>|</ol>|</table>|<blockquote class="org">)(&gt\;\s?){1,}(.+?(\n|$))' => '$1$3' },
    { '(</div>|</h\d>|^|\n|<hr>|</ul>|</ol>|</table>|<blockquote class="org">)(&gt\;\s?){1,}(.+?(\n|$))' => '$1$3' },

    #文字装飾
    { '\*{2}(.+?)\*{2}' => '<b>$1</b>' },
    { '\*{1}(.+?)\*{1}' => '<i>$1</i>' },
    { '~{2}(.+?)~{2}' => '<s>$1</s>' },


    # 簡易文字装飾書式（ゆとシートと同じ書式）
    { '[|｜](.+?)《(.*?)》' => '<ruby>$1<rp>(</rp><rt>$2</rt><rp>)</rp></ruby>' }, #なろうルビ
    { '《《(.+?)》》' => '<em>$1</em>' }, #カクヨム傍点
    { '\{\{(.+?)\}\}' => '<span class="hide">$1</span>' },
    { "'''(.+?)'''" => '<i>$1</i>' },
    { "''(.+?)''" => '<b>$1</b>' },
    { '%%(.+?)%%' => '<s>$1</s>' },
    { '__(.+?)__' => '<u>$1</u>' },


    # ソードワールド2.5の能力分類アイコン（いらなきゃ消す）
    { '\[([○◯〇]|常時?)\]' => '<i class="s-icon passive"><i>[常]</i></i>' },
    { '\[([△]|準備?|備)\]' => '<i class="s-icon setup"><i>[準]</i></i>' },
    { '\[([＞▶〆]|主(動作)?)\]' => '<i class="s-icon major"><i>[主]</i></i>' },
    { '\[([☆≫»]|>>|補(助(動作)?)?)\]' => '<i class="s-icon minor"><i>[補]</i></i>' },
    { '\[([□☑🗨]|宣言?)\]' => '<i class="s-icon active"><i>[宣]</i></i>' },

    # '置換前の文字列' => '置換後の文字列',
);

## ●追加した置き換えをヘルプに乗せたい場合
our @replace_help = (
  ['｜テキスト《てきすと》','<ruby>テキスト<rt>てきすと</rt></ruby>','ルビ（ふりがな）を振る'],
  ['《《テキスト》》','<em>テキスト</em>','傍点を振る'],
  ["''テキスト''",  '<b>テキスト</b>','太字にする'],
  ["'''テキスト'''",'<i>テキスト</i>','斜体にする'],
  ['%%テキスト%%',  '<s>テキスト</s>','打消線を引く'],
  ['__テキスト__',  '<u>テキスト</u>','下線を引く'],
  ['{{テキスト}}','<span class="hide">テキスト</span>','文字を透明にする。<br>（ドラッグで選択状態にすると見える）'],
  ['----',  '<hr>','四つ以上のハイフンで水平線'],
);

## ●背景画像・BGM再生に使用してよいURLを制限
# 1=する 0=しない
our $src_url_limit = 0;
## 制限する場合の許可URL一覧
# 前方一致
# http(s)://～は省略すること
our @src_url_list = (
  '',
  '',
  'xxx.yyyy.zzz.com', #例
);

## ●背景画像のプリセット
# ['URL','タイトル'], で記述する
our @bg_preset = (
  ['https://userdisk.webry.biglobe.ne.jp/012/472/52/N000/000/000/BG00a1_80.jpg',
   '昼空／(C)きまぐれアフター'],
  ['https://userdisk.webry.biglobe.ne.jp/012/472/52/N000/000/001/134747150552113113690_BG10a_1280.jpg',
   '森の道(昼)／(C)きまぐれアフター'],
);

## ●BGMのプリセット
# ['URL','タイトル',音量], で記述する（音量は1～100で記述（パーセンテージの数字のみ））
our @bgm_preset = (
  ['',
   'タイトル／(c)権利者名', 80],
  ['',
   '', 80],
);

## ●カスタムCSSファイルのURL
our $custom_css = '';

1;